# 内存管理

[TOC]

## 关键词

### 分层存储器体系

### 存储管理器

> 有效的管理内存
>
> 记录哪些内存是正在使用的 哪些是空闲的
>
> 在进程需要时 分配内存；不需要的时候 释放内存

## 实现方案

### 无存储器抽象

```assembly
MOV REGISTER1, 1000
```

> 问题在于无法或很难同时运行多个进程

### 地址空间

#### 概念

> 地址空间是一个进程可用于寻址内存的一套地址集合。每个进程都有自己的地址空间，并且这个地址空间独立于其他的进程的地址空间

- 基址寄存器 和 界限寄存器
  - 优点 无需重定位，硬件每次读区内存时都会加上基址和检查界限
  - 不足 每次需要加法和比较 性能上有影响

#### 交换技术

因为会发生内存超载，解决的方案就是交换技术或者虚拟内存

- 空闲区 空洞 hole
- 内存紧缩 memory compaction
- 预留动态分配的内存空间 一个段可动（数据段） 两个段可动（数据段和堆栈段）

#### 空闲内存管理

##### 位图

将内存划分为内存单元 位图管理

**不足** 分配内存的时候需要遍历位图 性能上有影响

##### 链表

###### 构成

每个节点包含一个进程或者一个空闲区域，包括进程、空闲的标志位；起始地址、长度；下一节点的指针

###### 内存分配算法

1. 首次适配 **快**
2. 下次适配
3. 最佳适配 **慢 会产生大量的无用小空闲区**
4. 最差适配 **不是一个好主意**
5. 快速适配 **为常用的大小分别维护链表** **显然，释放内存时很绝望**

###### 分配算法的优化

- 为进程和空闲区分别维护链表 **每个算法都会变快，但是释放内存的时候性能损失**
- （独立的链表）按照大小对空闲区排序 **释放内存时十分绝望**
  - 大->小 首次适配、最佳适配一样快
  - 小->大 最佳适配
- （独立的链表）空闲区可以使用空闲区来保存信息 不再需要使用额外的数据结构

## 虚拟内存

### 概念

> 每个程序拥有自己的地址空间，这个空间被划分为多个块，被称为页或者页面。
>
> 程序的运行并不强求要每一页都在内存中，如果跳转到不在内存中的页时，由操作系统来完成加载缺失的页然后重新执行上一步指令

### 分页





