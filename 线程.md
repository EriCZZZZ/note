# 线程

> 线程比进程更加的轻量，能更快的创建，也更容易撤销
>
> 多线程模型能够共用一个地址空间 有使用所有可用数据的能力

## 与进程的区别

线程拥有自己的

- 程序计数器
- 寄存器
- 堆栈
- 状态

## POSIX线程

pthread

```c
newThreadIdentifier = pthread_create();			// 创建一个新线程
pthread_exit();				// 结束当前线程
pthread_join();				// 等待一个特定的线程退出
pthread_yield();			// 释放CPU
pthread_attr_init();		// 创建并初始化一个线程的属性结构
pthread_attr_destroy();		// 删除一个线程的属性结构
```

## 线程的实现

> 线程的实现主要分两种： 在用户空间中和在内核中

### 整个线程包放置在用户空间中

内核完全不了解线程的存在

#### 优点

- 可以在不支持线程的os上实现多线程
- 更快 比陷入内核更快/不需要进行内核调用
- 更好的扩展性 用户可以自定义诸如调度算法等

#### 不足

- 如何实现阻塞系统调用/缺页中断
- （因为进程内部没有时钟中断）可能发生一个线程永远运行的问题

### 在内核中实现线程

#### 优点

阻塞系统调用，调度等不再是问题

#### 不足

- 多进程创建新进程时，是否需要复制所有的进程
- 性能上的问题
- 信号

### 混合实现

- 内核线程被用户线程多路复用

### 调度程序激活机制

> 为了模拟内核线程的功能，但为线程包提供通常在用户空间才能实现的更好的性能和更大的灵活性

### 弹出式线程

> 消息到达时，系统创建一个处理该消息的线程，这种线程称为弹出式线程

